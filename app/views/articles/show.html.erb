<p id="notice"><%= notice %></p>

<% if @article.videos.length != 0 && @article.images.length != 0 %>
  <!-- Show video and image together in carousel -->
  <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
    <div class="carousel-inner">
      <% @article.videos.each do |video| %>
        <div class="carousel-item active center-item">
          <%= video_tag video.to_s, controls: true, size: "250"%>
        </div>
      <% end %>
      <% @article.images.each do |img|%>
        <div class="carousel-item center-item">
          <%= image_tag(img.url, size: "600x600") %>
        </div>
      <% end %>
    </div>
    <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>
  </div>
  <% elsif @article.images.length!= 0%>
    <!-- only for image carousel -->
    <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
      <div class="carousel-inner">
        <% @article.images.each_with_index do |img, index|%>
          <% if index == 0 %>
            <div class="carousel-item active center-item">
              <%= image_tag(img.url, size: "600x600") %>
            </div>
          <% else %>
            <div class="carousel-item center-item">
              <%= image_tag(img.url, size: "600x600") %>
            </div>
          <% end %>
        <% end %>
      </div>
      <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>
  <% else %>
    <!-- video only -->
    <% @article.videos.each do |video| %>
      <div class="carousel-item active center-item">
        <%= video_tag video.to_s, controls: true, size: "250"%>
      </div>
    <% end %>
  <% end %>
  <hr>
  <br>

  <p><%= @article.title %></p>
  <p><%= @article.description %></p>
  <p>Number of views
    <%= @article.impressionist_count(:filter=>:ip_address) %>
  </p>
  <%= social_share_button_tag(@article.title , :url => request.original_url , desc: @article.description) %>
  <a href="whatsapp://send?text=<%= request.original_url %>">Share on WhatsApp</a>
  <% vote = Vote.find_by(article: @article.id, user_id: current_user.id) %>
    <% if !vote.nil? %>
      <!-- if vote find_by not nil is true-->
      <% if vote.vote? %>
        <!-- if vote value is true-->
        <%= link_to "UPVOTE | #{Vote.where(article_id: @article.id, vote: true).count}", upvote_article_votes_path(@article), class: "btn btn-default btn-sm upvote", :remote => true %>
        <%= link_to "DOWNVOTE | #{Vote.where(article_id: @article.id, vote: false).count}", downvote_article_votes_path(@article), class: "btn btn-default btn-sm downvote", :remote => true %>
      <% else %>
        <%= link_to "UPVOTE | #{Vote.where(article_id: @article.id, vote: true).count}", upvote_article_votes_path(@article), class: "btn btn-outline-default btn-sm upvote", :remote => true %>
        <%= link_to "DOWNVOTE | #{Vote.where(article_id: @article.id, vote: false).count}", downvote_article_votes_path(@article), class: "btn btn-default btn-sm downvote" , :remote => true%>
      <% end %>
    <% else %>
      <%= link_to "UPVOTE | #{Vote.where(article_id: @article.id, vote: true).count}", upvote_article_votes_path(@article), class: "btn btn-outline-secondary btn-sm upvote", :remote => true %>
      <%= link_to "DOWNVOTE | #{Vote.where(article_id: @article.id, vote: false).count}", downvote_article_votes_path(@article), class: "btn btn-default btn-sm downvote" , :remote => true%>
    <% end %>

    <%= link_to 'Edit', edit_article_path(@article) %>
    |
    <%= link_to 'Back', articles_path %>
    <div id="disqus_thread">
      <script>
        /**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

        var disqus_config = function () {
          this.page.url = "<%= request.original_url %>";
          this.page.identifier = 'article-<%= @article.id %>';

        };

        (function () { // DON'T EDIT BELOW THIS LINE
          var d = document,
            s = d.createElement('script');
          s.src = 'https://www-uglymalaysia.disqus.com/embed.js';
          s.setAttribute('data-timestamp', + new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
      <noscript>Please enable JavaScript to view the
        <a href="https://disqus.com/?ref_noscript#disqus_thread">comments powered by Disqus.</a>
      </noscript>
      <script id="dsq-count-scr" src="//www-uglymalaysia.disqus.com/count.js" async="async"></script>
    </div>
